#!/bin/sh
#
# /etc/init.d/S90npie - NeuraParse Inference Engine service
# Lightweight placeholder start script; exits success if daemon not present.
#

DAEMON="/usr/bin/npie-daemon"
PIDFILE="/var/run/npie.pid"
NAME="npie"

start() {
    echo "Starting $NAME..."
    if [ -x "$DAEMON" ]; then
        mkdir -p /var/run
        "$DAEMON" &
        echo $! > "$PIDFILE"
        echo "OK"
    else
        echo "$DAEMON not found; skipping (OK)"
    fi
}

stop() {
    echo "Stopping $NAME..."
    if [ -f "$PIDFILE" ]; then
        kill "$(cat "$PIDFILE")" 2>/dev/null || true
        rm -f "$PIDFILE"
    fi
    # Also try to kill by name if pidfile missing
    pkill -f npie-daemon 2>/dev/null || true
    echo "OK"
}

status() {
    if pidof npie-daemon >/dev/null 2>&1; then
        echo "$NAME is running"
        exit 0
    fi
    echo "$NAME is not running"
    exit 1
}

restart() {
    stop
    start
}

case "$1" in
    start) start ;;
    stop) stop ;;
    restart) restart ;;
    status) status ;;
    *) echo "Usage: $0 {start|stop|restart|status}" ; exit 1 ;;
esac

